<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸ—œ Deflator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 30px;
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .controls {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    label {
      font-weight: 600;
      color: #555;
      font-size: 14px;
    }
    
    select {
      padding: 8px 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    
    select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 24px;
    }
    
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    textarea {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      transition: border-color 0.2s;
      margin-bottom: 20px;
    }
    
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .stat-label {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
    }
    
    .stat-sub {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 5px;
    }
    
    .output-section {
      margin-top: 20px;
    }
    
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .output-box {
      background: #f5f5f5;
      border: 2px solid #ddd;
      border-radius: 6px;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      word-break: break-all;
      max-height: 200px;
      overflow-y: auto;
      color: #333;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: transform 0.1s, box-shadow 0.2s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .loading {
      opacity: 0.6;
    }
    
    .error {
      background: #fee;
      color: #c33;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ—œ Deflator</h1>
    <p class="subtitle">Test native JavaScript compression. Will compression help for your use case? Find out in real time.</p>
    
    <div class="controls">
      <div class="control-group">
        <label for="format">Compression Format</label>
        <select id="format">
          <option value="gzip">gzip</option>
          <option value="deflate">deflate</option>
          <option value="deflate-raw">deflate-raw (most compact)</option>
        </select>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="urlSafe" checked>
        <label for="urlSafe">URL-safe Base64</label>
      </div>
    </div>
    
    <label for="input">Input Data</label>
    <textarea id="input" placeholder="Type or paste your data here...">{"example": "data", "test": "hello world", "repeat": "this is a longer string to see compression benefits"}</textarea>
    
    <div id="results"></div>
  </div>

  <script>
    const inputEl = document.getElementById('input');
    const formatEl = document.getElementById('format');
    const urlSafeEl = document.getElementById('urlSafe');
    const resultsEl = document.getElementById('results');
    
    let debounceTimer;
    
    function debounce(func, delay) {
      return function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(func, delay);
      };
    }
    
    async function compressData() {
      const input = inputEl.value;
      const format = formatEl.value;
      const urlSafe = urlSafeEl.checked;
      
      if (!input) {
        resultsEl.innerHTML = '';
        return;
      }
      
      try {
        const encoder = new TextEncoder();
        const data = encoder.encode(input);
        
        const stream = new Blob([data]).stream();
        const compressedStream = stream.pipeThrough(new CompressionStream(format));
        const compressedBlob = await new Response(compressedStream).blob();
        const compressedArray = new Uint8Array(await compressedBlob.arrayBuffer());
        
        // Convert to base64
        let base64 = btoa(String.fromCharCode(...compressedArray));
        
        // Make URL-safe if requested
        if (urlSafe) {
          base64 = base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
        }
        
        const originalSize = data.byteLength;
        const compressedSize = compressedArray.byteLength;
        const base64Size = base64.length;
        const ratio = ((compressedSize / originalSize) * 100).toFixed(1);
        const base64Ratio = ((base64Size / originalSize) * 100).toFixed(1);
        const saved = originalSize - compressedSize;
        const base64Saved = originalSize - base64Size;
        
        resultsEl.innerHTML = `
          <div class="stats">
            <div class="stat-card">
              <div class="stat-label">Original Size</div>
              <div class="stat-value">${originalSize}</div>
              <div class="stat-sub">bytes</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Compressed Size</div>
              <div class="stat-value">${compressedSize}</div>
              <div class="stat-sub">${ratio}% of original (saved ${saved} bytes)</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Base64 Size</div>
              <div class="stat-value">${base64Size}</div>
              <div class="stat-sub">${base64Ratio}% of original (${base64Saved >= 0 ? 'saved' : 'added'} ${Math.abs(base64Saved)} bytes)</div>
            </div>
          </div>
          
          <div class="output-section">
            <div class="output-header">
              <label>Compressed Output (Base64)</label>
              <button onclick="copyToClipboard()">Copy to Clipboard</button>
            </div>
            <div class="output-box" id="outputBox">${base64}</div>
          </div>
        `;
      } catch (error) {
        resultsEl.innerHTML = `<div class="error">Error: ${error.message}</div>`;
      }
    }
    
    function copyToClipboard() {
      const outputBox = document.getElementById('outputBox');
      const text = outputBox.textContent;
      navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'Copied!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      });
    }
    
    const debouncedCompress = debounce(compressData, 300);
    
    inputEl.addEventListener('input', debouncedCompress);
    formatEl.addEventListener('change', compressData);
    urlSafeEl.addEventListener('change', compressData);
    
    // Initial compression
    compressData();
  </script>
</body>
</html>
